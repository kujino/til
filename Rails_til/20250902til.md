# 2025/09/02の日報
## 今日やったこと
* パスワードのリセット機能の実装(途中)
gem sorceryのサブモジュールを導入(password_reset)<br>
config/sorcery.rbの編集, UserMailer<br>
Usersテーブルにpassword_resetに関するカラムを追加<br>
Userモデルにpassword_resetに関するバリデーションを追加<br>
パスワードリセット申請フォームのビュー作成<br>
パスワードリセットのコントローラーを生成<br>
<br>
まで

## 学習メモ

```
def create
  @user = User.find_by(email: params[:email])
  @user&.deliver_reset_password_instructions!
end
```

`@user&.`の`&.`は安全ナビゲーション演算子。<br>
@userが存在しなくてもnillを返す = パスワードリセットのメールを送る際に存在しないアドレスでもエラーを返さないためセキュリティ対策に繋がる。<br>
`deliver_reset_password_instruction!` : パスワードリセットメールを送る処理<br>
`@user = User.find_by(email: params[:email])` : ユーザーテーブルからemailカラムを指定し、対象のアドレスを@userへ

```
def update
  @token = params[:id]
  @user = User.load_from_reset_password_token(@token)

  return not_authenticated if @user.blank?

  @user.password_confirmation = params[:user][:password_confirmation]
  if @user.change_password(params[:user][:password])
    redirect_to login_path, success: t('password_reset.update.success')
  end
end
```
`@user = User.load_from_reset_password_token(@token)` : ユーザーテーブルにあるトークンとアクセスにより受け取ったトークンの照合。<br>
`return not_authenticated if @user.blank?`<br>
照合が取れない場合`return not_authenticated`でリダイレクト処理。<br>
<br>
`@user.password_confirmation = params[:user][:password_confirmation]`
@userに確認用パスワードを代入し、`if @user.change_password(params[:user][:password])`で照合している。<br>

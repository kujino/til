# 2025/10/04,05の日報
## 学習したこと
### 管理画面検索機能の追加(続き)
本文検索の実装において、scpeで`Article.body`を指定していたが、記事ブロックをである`senteceテーブル`を指定しなければ検索がかからなかった。

ここをdefault_scopeの設定のせいだと思っていたので実装までに時間がかかってしまった。

scopeの書き方をもっと理解したい、特にSQLクエリになるコードの書き方は覚えたい

### ユーザーごとのアクセス権限の設定
管理者、編集者、ライターなどの権限によってアクセスできる範囲を変更する処理
アクセス権限は`gem pundit`を使用して行う
* app/polisies配下のファイルにアクションに対してユーザーごとのアクセス可否を設定
```ruby
#カテゴリーページにおける各アクションの権限設定
#この場合管理者または編集者
class CategoryPolicy < TaxonomyPolicy
  def index?
    user.admin? || user.editor?
  end

  def edit?
    user.admin? || user.editor?
  end

  def destroy?
    user.admin? || user.editor?
  end
end
```

* 認可についてはapplication_polociyファイルで設定
```ruby
def initialize(user, record)
    @user = user
    @record = record
  end

  def index?
    false
  end

  def show?
    false
  end
```

* 権限がないユーザーがアクセスした際の例外を403ステータスにするための処理
```ruby
#app/public/配下に403.htmlを生成しメッセージ記述、config/application.rbに以下の記述
config.action_dispatch.rescue_responses["Pundit::NotAuthorizedError"] = :forbidden
```
`:forbidden`は403エラーのシンボル
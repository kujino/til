# 2025/09/30の日報
##　学習したこと
### (self)についての深堀り
```ruby
def show
    @article = Article.find_by!(uuid: params[:article_uuid]) #@articleにArticleモデルの対象のuuidに関連づいた記事の取得
    @article.body = @article.build_body(self) # @articleのbodyにモデルで定義したbuild_bodyの内容を適用、(self)はそのために現在のコントローラーのインスタンスをbuild_bodyに渡す
end
```

```ruby
def build_body(controller)
    result = '' #ここに各ブロックの要素をまとめていく

    article_blocks.each do |article_block|
      result << if article_block.sentence?
                  sentence = article_block.blockable
                  sentence.body
                elsif article_block.medium?
                  medium = ActiveDecorator::Decorator.instance.decorate(article_block.blockable)
                  controller.render_to_string("shared/_media_#{medium.media_type}", locals: { medium: medium }, layout: false)
                elsif article_block.embed? #コントローラーの機能をモデルで行うための記述、ビューファイルへデータを渡すため
                  embed = ActiveDecorator::Decorator.instance.decorate(article_block.blockable)
                  controller.render_to_string("shared/_embed_#{embed.embed_type}", locals: { embed: embed }, layout: false)
                end
    end
```

本来ビューへとデータを渡すのはコントローラーの役割だが、ここではその処理をモデルにさせている。

理由としては違うテーブルからデータを取得しまとめるため、コントローラーでそれをすると余計な手間が増える

モデルに処理させることで、メソッドの流用性が高くなる(複数のコントローラーで使いたい時に使いまわせる) → 保守性、拡張性という観点

build_body(controller)メソッドについてchatGPTの解説

1. **引数に指定したビューファイル（部分テンプレート）を探す**
    
    例: `shared/_media_image.html.slim` や `shared/_media_video.html.slim`
    
2. **そこに `locals` で渡したデータ（ここでは `medium`）を差し込んで描画する**
    
    → テンプレート内で `medium` が使える
    
3. **描画結果（= HTML文字列）を返す**
    
    → `render` では画面に出るけど、`render_to_string` は「返り値が文字列」になる
    

### なので一言で言うと

「指定した部分テンプレートにデータを流し込み、完成したHTML文字列を返す」処理です。

### ブログアプリにて、文章ブロックを追加し内容を書かずプレビューするとエラー

 `TypeError (no implicit conversion of nil into String)`

```ruby
result << if article_block.sentence?
                  sentence = article_block.blockable
                  sentence.body.to_s #to_sを付けないとnilの時にエラーとなる
                  
                  sentence.body ||= " " #という記述でも可能( sentence.bodyが未定義ならスペースを代入)
```

### Rubyアルゴリズム

* 配列Mの中身をNの分だけ出力
```ruby
N = gets.to_i
M = gets.split.map(&:to_i)
M.each do |m|
	    puts (1..m).to_a.join(" ") #M番目の整数値の数まで配列からカウントを出力
end
```

* 小数点以下の取り扱い
```ruby
N = 1.234
N = gets.to_i #整数値に変換しようとすると少数点は数字でないため1しか出力されない

N = gets
	puts N #文字列として取得し出力することで小数点以下も出力される
```

* 指定された小数点の出力
```ruby
input_line = gets.to_f #文字列を10進数と解釈(今回は別に不要)
printf("%.3f\n", input_line.)　#小数点を3桁まで表示、三桁に満たない場合は0
```

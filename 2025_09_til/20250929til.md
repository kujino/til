# 2025/09/29の日報
## 学習したこと(Rails)
### バグ修正
ブログ記事編集時、画像ブロックを置いてファイルをアップしないままプレビューしようとするとエラーが出るので修正。ファイルがアップされている場合は画像を表示するようif文を使って記述。ファイルがない場合はそのまま出力される。

* 気になったコード(selfがいまいちわかってない)
```ruby
def show
    @article = Article.find_by!(uuid: params[:article_uuid]) #@articleにArticleモデルの対象のuuidに紐づく記事の取得
    @article.body = @article.build_body(self) # @articleのbodyにモデルで定義したbuild_bodyの内容を適用、(self)はそのために現在のコントローラーのインスタンスをbuild_bodyに渡す
  end
```

モデル側
```ruby
def build_body(controller)
    result = ''

    article_blocks.each do |article_block|
      result << if article_block.sentence?
                  sentence = article_block.blockable
                  sentence.body
                elsif article_block.medium?
                  medium = ActiveDecorator::Decorator.instance.decorate(article_block.blockable)
                  controller.render_to_string("shared/_media_#{medium.media_type}", locals: { medium: medium }, layout: false)
                elsif article_block.embed?
                  embed = ActiveDecorator::Decorator.instance.decorate(article_block.blockable)
                  controller.render_to_string("shared/_embed_#{embed.embed_type}", locals: { embed: embed }, layout: false)
                end
    end
```

### パンくずの表示
* gemを使ってパンくず表示
* config/breadcrumbs.rbに表示させたいパンくずの記述
```ruby
crumb :edit_admin_tag do |tag| #ビューファイルに渡す名前(なんでもいいがわかるように)
  link 'タグ編集', edit_admin_tag_path(tag) #パンくずのリンク、表示させたい文字列とパス指定
  parent :admin_tags #親となるページ名、この場合タグindexページ(rails/info/routesで確認)
end

管理画面 > タグ > タグ編集#と表示された
```

### 心得ておきたい考え方

実装したい処理をどのファイルに書くべきかとAIに相談したときに

- **ビューでの分岐** → 表示ロジック。
- **コントローラーでの分岐** → 制御ロジック。
- **モデルでの分岐** → データロジック。

とアドバイスいただいた、これは頭に入れておきたい。  
また、同期の方にモデルを太らせるほうがいいらしいと聞いた。ここは深掘りたい。